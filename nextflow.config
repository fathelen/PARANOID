singularity {
	enabled = true
	autoMounts = true
	//cacheDir = "/opt/galaxy/current/docker-container"
	//cacheDir = "/vol/sge-tmp/pbarth/singularity"
}

profiles {
	sge {
		process.executor = 'sge'
		process.shell = ['/usr/bin/env', 'bash']
		process.queue = 'all.q'
		process.clusterOptions = '-V -S /bin/bash'
		process.penv = 'multislot'
	}

	slurm {
		process.executor = 'slurm'
	}

	local {
		process.executor = 'local'
	}
}

process {
	withName: 'quality_control|quality_control_2' {
		cpus = 1
		memory = '1 GB'
		container = 'docker://pbarth/fastqc.img:test_pipeline'
	}
	withName: adapter_removal {
		cpus = 1
		memory = '5 GB'
		container = 'docker://pbarth/trim_galore:test_pipeline_1.2'
	}
	withName: quality_filter {
		cpus = 1
		memory = '1 GB'
		container = 'docker://pbarth/fastx:test_pipeline'
	}
	withName: remove_exp_barcode {
		cpus = 1
		memory = '10 MB'
		container = 'docker://pbarth/fastx:test_pipeline'
	}
	withName: extract_rnd_barcode {
		cpus = 1
		memory = '1 GB'
		container = 'docker://pbarth/umi-tools:test_pipeline'
	}
	withName: deduplicate {
		cpus = 1
		memory = '100 GB'
		container = 'docker://pbarth/umi-tools:test_pipeline'
	}
	//TODO: needs checking
	withName: 'check_barcode_file|get_length_exp_barcode|merge_preprocessed_reads|get_top_hits|remove_newlines|extract_top_transcript_sequences' {
		cpus = 1
		memory = '500 MB'
		container = 'docker://pbarth/base:test_pipeline'
	//TODO: needs checking
	}
	//TODO samtools -> filter empty bam; merge deduplicate; count hits; index alignments; extract top alignments
	withName: 'merge_deduplicated_bam|count_hits|filter_empty_bams|index_alignments|extract_top_alignments|index_for_peak_calling' {
		cpus = 1 
		memory = '10 GB'
		container = 'docker://pbarth/samtools:test_pipeline_1.1'

	}
	//TODO bamtools
	withName: 'split_bam_by_chromosome' {
		cpus = 1
		memory = '500 MB'
		container = 'docker://pbarth/bamtools:test_pipeline_1.1'

	}
	//TODO: needs checking
	withName: 'merge_wigs' {
		cpus = 1 
		memory = '500 MB'
		container = 'docker://pbarth/merge:test_pipeline'

	}
	withName: split_exp_barcode {
		cpus = 1
		memory = '500 MB'
		container = 'docker://pbarth/fastx:test_pipeline'
	}
	withName: 'build_index_bowtie|mapping_bowtie' {
		cpus = 4
		memory = '500 MB'
		container = 'docker://pbarth/bowtie2:test_pipeline_1.2'
	}
	withName: 'build_index_STAR|mapping_STAR' {
		cpus = 8
		memory = '100 GB'
		container = 'docker://pbarth/star:test_pipeline_1.1'
	}
	withName: calculate_crosslink_sites {
		cpus = 1
		memory = '100 MB'
		container = 'docker://pbarth/determine_cl_sites:test_pipeline_1.2'
	}
	//TODO: Needs checking for resource usage
	withName: feature_counts {
		cpus = 1
		memory = '100 MB'
		container = 'docker://pbarth/sublime:test_pipeline_1.0'
	}
	//TODO: needs checking
	withName: pureCLIP {
		cpus = 8
		memory = '10 GB'
		container = 'quay.io/biocontainers/pureclip:1.3.1--0'
	}
	withName: multiqc {
		cpus = 1
		memory = '10 GB'
		container = 'docker://pbarth/multiqc:test_pipeline_1.0'
	}
	//TODO: check resource usage
	withName: wig_to_bam {
		cpus = 1
		memory = '10 GB'
		container = 'docker://pbarth/wig2bam:test_pipeline_1.0'
	}
	//TODO: check resource usage
	withName: get_RNA_species_distribution{
		cpus = 1
		memory = '10 GB'
		container = 'docker://pbarth/rna_species_distribution:test_pipeline_1.0'
	}
	//TODO: check resource usage
	withName: generate_RNA_species_barplot{
		cpus = 1
		memory = '10 GB'
		container = 'docker://pbarth/rna_species_barchart:test_pipeline_1.0'
	}
	//TODO: check resource usage
	withName: generate_barcode_barplot{
		cpus = 1
		memory = '10 GB'
		container = 'docker://pbarth/barcode_barchart:test_pipeline_1.0'
	}
}
