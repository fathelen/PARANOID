#!/usr/bin/env Rscript
if( !require("BiocManager", character.only=TRUE )){install.packages("BiocManager")}
CRAN_packages <- c("optparse")
bioconductor_packages <- c()

for(p in CRAN_packages){
  if( !require( p, character.only=TRUE )){ install.packages(p,repos='http://cran.us.r-project.org') }
  library( p, character.only=TRUE )
}
for(p in bioconductor_packages){
  if( !require( p, character.only=TRUE )){ BiocManager::install(p) }
  library( p, character.only=TRUE )
}

option_list = list(
  make_option(c("-i", "--input"), type="character", default=NULL, 
              help="Input tsv generated by previous pipeline process", metavar="character"),
  make_option(c("-o", "--output"), type="character", default="out.png", 
              help="Output file name", metavar="character"),
  make_option(c("-c", "--color"), type="character", default="#69b3a2", 
              help="Color", metavar="character")
);
opt_parser = OptionParser(option_list=option_list);
opt = parse_args(opt_parser);

input_file <- opt$input
output_file <- opt$output
color <- opt$color

input_data <- read.table( file = input_file,
                          sep = "\t",
                          header = TRUE,
                          row.names = 1)

list_of_species <- row.names(input_data)
list_of_species <- list_of_species[-length(list_of_species)]

png(filename = output_file )
barplot(name = list_of_species, height = input_data[list_of_species,1], col = color, las = 2)
dev.off()
